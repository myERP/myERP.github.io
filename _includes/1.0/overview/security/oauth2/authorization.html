<div id="authorization" class="group">

    <h2>Obtain an Authorization Code</h2>

    {% highlight bash %}Endpoint: {{site.oauth2.protocol}}://{{ site.oauth2.domain }}{{site.oauth2.endpoints.authorization.url}}{% endhighlight %}

    <p>The OAuth2 Flow is initiated by pointing the end-user's browser to the endpoint shown above. All the following query parameters are required:</p>

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Parameter</th>
                <th>Valid Values</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>response_type</td>
                <td><b>code *</b></td>
                <td>Indicates that the client expects to receive an authentication code that will later be exchanged by an access token</td>
            </tr>
            <tr>
                <td>client_id</td>
                <td><i>your_client_id</i></td>
                <td>The unique id that was provided to you after your client credential was created</td>
            </tr>
            <tr>
                <td>redirect_uri</td>
                <td><i>your_redirect_uri</i></td>
                <td>The callback url that was provided to us when you requested your client credential</td>
            </tr>
            <tr>
                <td>scope</td>
                <td style="white-space: nowrap;"><b>offline_access *</b></td>
                <td>The only scope available. It indicates that you will have read access to user's data and you will receive a <i>refresh token</i> when exchanging the authentication code</td>
            </tr>
            <tr>
                <td>state</td>
                <td><i>any_string</i></td>
                <td>This value must be present in the authorization response and must be the same as the one you sent in the request. <br>For more information on how to take advantage of this parameter, check <a href="https://auth0.com/docs/protocols/state-parameters" target="_blank">this article</a></td>
            </tr>
        </tbody>
    </table>
    <p style="text-align: right"><small><b>* only one possible valid value</b></small></p>

{% highlight http %}
GET {{site.oauth2.endpoints.authorization.url}}?response_type=code&client_id=xxxxxxxxxx&redirect_uri=xxxxxxxxxx&scope=offline_access&state=xxxxxxxxxx HTTP/1.1
Host: {{ site.oauth2.domain }}
{% endhighlight %}

{% highlight bash %}
curl -D- --request GET '{{site.oauth2.protocol}}://{{ site.oauth2.domain }}{{site.oauth2.endpoints.authorization.url}}'\
'?response_type=code'\
'&client_id=xxxxxxxxxx'\
'&redirect_uri=xxxxxxxxxx'\
'&scope=offline_access'\
'&state=xxxxxxxxxx'
{% endhighlight %}

    <p>The OneUp Authorization Server response will be a redirect to the login page:</p>

    <img alt="login page" src="/img/login_page.png" style="height: 100%; width: 100%; object-fit: contain; margin-bottom: 10px"/>

    <p>The user fills the login information and press the <kbd>sign in</kbd> button.</p>

    <p>The authentication server authenticates the user and redirects him back to the Authorization Server.</p>

    <p>The OneUp Authorization Server redirects the user to the consent page:</p>

    <img alt="consent page" src="/img/consent_page.png" style="height: 100%; width: 100%; object-fit: contain; margin-bottom: 10px"/>

    <p>The user press the <kbd>allow</kbd> button. The web application redirects the user to the Authorization Server.</p>

    <p>The authorization flow is finished and the Authorization Server sends the authorization code through your <kbd>callback</kbd> url:</p>

{% highlight http %}
GET /xxxxxxxxxx?code=xxxxxxxxxx HTTP/1.1
Host: your.host
{% endhighlight %}

    <div class="panel panel-warning">
        <div class="panel-heading">Note</div>
        <div class="panel-body">
            In case the user press the <kbd>deny</kbd> button. The Authorization will reply with the following response to your <kbd>callback</kbd> url:</p>

{% highlight http %}
GET error=access_denied&error_description=the+resource+owner+denied+the+request&state=xxxxxxxxxx HTTP/1.1
Host: your.host
{% endhighlight %}
        </div>
    </div>
</div>